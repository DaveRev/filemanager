(function(a){a(["jquery","underscore","backbone","collections/col_select","modules/mod_sysmessage","templates/_templates"],function(a,b,c,d,e,f){function g(){var a={error:{message:e.file_select_limit_exceed,context:{count:this.collection.settings.limit}}};return new e("error",a,!1)}var h=c.View.extend({events:{"click .remove":"removeFromList"},initialize:function(){this.collection=new d,this.dirtree=this.options.dirtree,this.fieldname=this.options.fieldname,this.dirtree.on("select",b.bind(this.update,this)),this.collection.on("add",b.bind(this.addItem,this)).on("remove",b.bind(this.removeItem,this)),this.collection.on("selectionlimitexceed",b.bind(g,this)),this.prePopulate()},prePopulate:function(){var a=this,b=this.$el.find(".file-selected input[type=hidden]"),c=[],d=[];b.each(function(){c.push(this.value)}),d=this.dirtree.collection.deferred.done(function(){var b=a.dirtree.collection.getByFileName(c);a.collection.add(b,{silent:!0}),a.render(),a.trigger("prepoulate",a.collection.pluck("id"))})},getFiles:function(){return this.collection.pluck("path")},render:function(){var a=this,c="",d=f.selected;this.collection.each(function(e){e=e.toJSON(),b.extend(e,{fieldname:a.fieldname}),c+=d(e)}),this.el.innerHTML=c},addItem:function(a){a=a.toJSON(),a.fieldname=this.fieldname;var b=a.id,c=f.selected(a);this.$el.append(c)},removeFromList:function(a){var b=parseInt(a.target.id.split("remove-")[1],10);this.removeItem(this.collection.get(b))&&this.trigger("removedselected",b)},removeItem:function(b){var c=b.id,d=a("#item-"+b.id);if(this.collection.remove(c)){d.remove();return!0}return!1},update:function(a,b){switch(a){case"add":this.collection.add(b);break;case"remove":this.collection.remove(b)}}});return h})})(this.define)
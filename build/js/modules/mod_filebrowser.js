define(["jquery","backbone","underscore","templates/templates"],function(a,b,c,d){var e=b.Model.extend({url:Symphony.WEBSITE+"/symphony/extension/filemanager/listing/",initialize:function(){this.deferred=this.fetch({data:{field_id:a("#filemanager").find('input[name="fields[field_id]"]').val()}})}}),f=b.View.extend({initialize:function(){c.bindAll(this)},events:{"click .dir-toggle":"toggleDir"},toggleDir:function(b){b.preventDefault(),b.stopPropagation();var c=a(b.target).parents().filter(".dir:not(#dir-list-root)").first(),d=c.find("> .sub-dir"),e=c.find(".dir-toggle");console.log(c),console.log(d),d.slideToggle(),c.toggleClass("open")},render:function(){var a=this;this.collection.deferred.done(this.renderDir),this.collection.deferred.error(this.renderErr)},renderDir:function(a){var b=this,c=this.renderTemplate(a,!0);this.$el.html(c),console.log("TEST:",this.collection.get("subdirs"))},renderErr:function(a){console.log("error: ",a)},renderTemplate:function(b,e){var f=this,g,h={},i='<ul class="dir'+(e?'" id="dir-list-root"':' sub-dir"')+">";for(g in b){if(g==="subdirs")for(var j=0,k=b[g].length;j<k;j++)i+=c.template(d.dirs,a.extend(h,b[g][j],{contents:this.renderTemplate(b[g][j].directory)}));if(g==="files")for(var l=0,m=b[g].length;l<m;l++)i+=c.template(d.files,b[g][l])}i+="</ul>",delete h;return i}});return{Collection:e,View:f}})
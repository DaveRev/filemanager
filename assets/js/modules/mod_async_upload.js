/**
 * @package Modules
 * @author thomas appel <mail@thomas-appel.com>

 * Displays <a href="http://opensource.org/licenses/gpl-3.0.html">GNU Public License</a>
 * @license http://opensource.org/licenses/gpl-3.0.html GNU Public License
 */

(function(a,b,c){var d={xhrFileUpload:!!a.XMLHttpRequestUpload&&!!a.FileReader,xhrFormDataFileUpload:!!a.FormData},e={cache:!1,type:"POST",processData:!1,contentType:!1},f=d.xhrFormDataFileUpload;b(["jquery","underscore","backbone","plugins/jquery-iframe-transport/jquery-iframe-transport"],function(b,c,d){function o(){this.initialize.apply(this,arguments)}var g,h=function(a){var b=a.find("form"),c=b.length;return a.get(0).nodeName.toLowerCase()!=="form"||!c?a=a.find("input, textarea, select"):c&&(a=b),a.serializeArray()},i=function(){return f?function(d){var e=new a.FormData;return c.each(d,function(d,f,g){d instanceof a.Blob?e.append(f+"[]",d,f.name):d instanceof b&&c.each(h(d),function(a){e.append(a.name,a.value)})}),e}:function(a){var b=h(a.context);return b.push({name:"iframe",value:!0}),b}}(),j=function(a){var b=a.originalEvent,c=b.total||b.totalSize,d=b.loaded;this.trigger("progress",d,c)},k=function(){var a=b.ajaxSettings.xhr();return a.upload&&b(a.upload).on("progress",c.bind(j,this)),a},l=function(){return f?function(b){if(!!b.file&&b.file instanceof a.Blob)return!b.file.name&&b.file.fileName&&(b.file.name=b.file.fileName),!b.file.size&&b.file.fileSize&&(b.file.size=b.file.fileSize),b;throw"no file found"}:function(a){return a}}(),m=function(a){return c.extend({url:this.settings.url,data:i(l(a)),xhr:c.bind(k,this)},g.defaults)},n=function(){return f?m:function(a){var b=a.form;return a=m.call(this,a),a.files=b,a.iframe=!0,a.dataType="iframe json",a}}();return o.prototype.initialize=function(){},c.extend(o.prototype,d.Events),o.extend=d.Model.extend,g=o.extend({initialize:function(a){this.settings=c.extend(c.clone(g.defaults),a||{})},send:function(a){a=n.call(this,a);var c=b.ajax(a);return c}}),g.defaults=function(){return f?e:c.extend(e,{files:"",form:"",processData:!1})}(),g.isXHRFileUpload=f,g})})(this,this.define)